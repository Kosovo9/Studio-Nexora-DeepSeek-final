"use strict";(()=>{var e={};e.id=5068,e.ids=[5068],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},6005:e=>{e.exports=require("node:crypto")},60794:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>h,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{POST:()=>c});var o=t(49303),a=t(88716),n=t(60670),i=t(87070),u=t(81584),p=t(68908);async function c(e){try{let{userId:r}=await (0,u.I)();if(!r)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{bucket:t,path:s,expiresIn:o}=await e.json();if(!t||!s)return i.NextResponse.json({error:"Missing bucket or path"},{status:400});if(!s.startsWith(`${r}/`))return i.NextResponse.json({error:"Access denied"},{status:403});let a=await (0,p.qu)(t,s,o||86400);return i.NextResponse.json({signedUrl:a})}catch(e){return console.error("Signed URL error:",e),i.NextResponse.json({error:"Failed to create signed URL",details:e.message},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/storage/signed-url/route",pathname:"/api/storage/signed-url",filename:"route",bundlePath:"app/api/storage/signed-url/route"},resolvedPagePath:"C:\\estudio-nexora-comet\\app\\api\\storage\\signed-url\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:g,serverHooks:m}=d,x="/api/storage/signed-url/route";function h(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},68908:(e,r,t)=>{t.d(r,{CV:()=>o,qu:()=>a});var s=t(85662);async function o(e){let{bucket:r,path:t,file:o,contentType:a,isPublic:n=!1}=e;try{let{data:e,error:i}=await s.O.storage.from(r).upload(t,o,{contentType:a||o.type,upsert:!1,cacheControl:"3600"});if(i)throw Error(`Upload failed: ${i.message}`);if(n){let{data:{publicUrl:o}}=s.O.storage.from(r).getPublicUrl(t);return{path:e.path,url:o}}return{path:e.path}}catch(e){throw console.error("Secure upload error:",e),e}}async function a(e,r,t=86400){try{let{data:o,error:a}=await s.O.storage.from(e).createSignedUrl(r,t);if(a)throw Error(`Failed to create signed URL: ${a.message}`);return o.signedUrl}catch(e){throw console.error("Signed URL error:",e),e}}},85662:(e,r,t)=>{t.d(r,{O:()=>s});let s=(0,t(76429).eI)("https://mdngrazjggsunpvtwbam.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1kbmdyYXpqZ2dzdW5wdnR3YmFtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1NjMyMDQsImV4cCI6MjA3ODEzOTIwNH0.EZD2ujsGnwUtz8rafZHOe8vDMOdoOcNYx8kBClqQxWs")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[2510,1584,6628],()=>t(60794));module.exports=s})();