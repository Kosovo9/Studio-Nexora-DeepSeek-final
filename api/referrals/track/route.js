"use strict";(()=>{var e={};e.id=6479,e.ids=[6479],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},6005:e=>{e.exports=require("node:crypto")},69566:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>x,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var a={};t.r(a),t.d(a,{POST:()=>c});var s=t(49303),n=t(88716),i=t(60670),o=t(87070),l=t(81584),p=t(85662);async function c(e){try{let{userId:r}=await (0,l.I)(),{referralCode:t,eventType:a,amount:s,transactionId:n}=await e.json();if(!t||!a)return o.NextResponse.json({error:"Missing required fields: referralCode, eventType"},{status:400});let{data:i,error:c}=await p.O.from("affiliates").select("*").eq("referral_code",t).single();if(c||!i)return o.NextResponse.json({error:"Invalid referral code"},{status:404});let d=s?.2*s:0,{data:u,error:m}=await p.O.from("referrals").insert({affiliate_id:i.user_id,referral_user_id:r||null,commission_amount:d,status:"payment_completed"===a?"completed":"pending",transaction_type:a,transaction_id:n||null}).select("id").single();if(m)return console.error("Error creating referral:",m),o.NextResponse.json({error:"Failed to track referral"},{status:500});return await p.O.from("affiliates").update({total_referrals:(i.total_referrals||0)+1,total_earnings:"payment_completed"===a?(i.total_earnings||0)+d:i.total_earnings,pending_earnings:"payment_completed"===a?i.pending_earnings:(i.pending_earnings||0)+d}).eq("id",i.id),o.NextResponse.json({success:!0,referralId:u.id})}catch(e){return console.error("Referral tracking error:",e),o.NextResponse.json({error:"Internal server error",details:e.message},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/referrals/track/route",pathname:"/api/referrals/track",filename:"route",bundlePath:"app/api/referrals/track/route"},resolvedPagePath:"C:\\estudio-nexora-comet\\app\\api\\referrals\\track\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:u,staticGenerationAsyncStorage:m,serverHooks:f}=d,g="/api/referrals/track/route";function x(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},85662:(e,r,t)=>{t.d(r,{O:()=>a});let a=(0,t(76429).eI)("https://mdngrazjggsunpvtwbam.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1kbmdyYXpqZ2dzdW5wdnR3YmFtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1NjMyMDQsImV4cCI6MjA3ODEzOTIwNH0.EZD2ujsGnwUtz8rafZHOe8vDMOdoOcNYx8kBClqQxWs")}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[2510,1584,6628],()=>t(69566));module.exports=a})();